<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
<!--<![endif]-->

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Metronome</title>
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<!--<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/6.0.0/normalize.min.css" crossorigin="anonymous"> -Inc in bootstrap!-->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" crossorigin="anonymous">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/9.8.0/css/bootstrap-slider.min.css">

	<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/webcomponentsjs/0.7.24/webcomponents.min.js" type="application/javascript" type="application/javascript" crossorigin="anonymous"></script>-->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js" type="application/javascript" crossorigin="anonymous"></script>
	<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" crossorigin="anonymous"></script> -using slim!-->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.slim.min.js" type="application/javascript" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" type="application/javascript" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" type="application/javascript" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js" type="application/javascript" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.0.3/howler.min.js" type="application/javascript" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/9.8.0/bootstrap-slider.min.js" type="application/javascript" crossorigin="anonymous"></script>
</head>

<body>
	<!--[if lt IE 7]>
		<p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="#">upgrade your browser</a> to improve your experience.</p>
	<![endif]-->

	<style>
		/* Space out content a bit */

		body {
			padding-top: 1.5rem;
			padding-bottom: 1.5rem;
		}
		/* Everything but the jumbotron gets side spacing for mobile first views */

		.header,
		.marketing,
		.footer {
			padding-right: 1rem;
			padding-left: 1rem;
		}
		/* Custom page header */

		.header {
			padding-bottom: 1rem;
			border-bottom: .05rem solid #e5e5e5;
		}
		/* Make the masthead heading the same height as the navigation */

		.header h3 {
			margin-top: 0;
			margin-bottom: 0;
			line-height: 3rem;
		}
		/* Custom page footer */

		.footer {
			padding-top: 1.5rem;
			color: #777;
			border-top: .05rem solid #e5e5e5;
		}
		/* Customize container */

		@media (min-width: 48em) {
			.container {
				max-width: 46rem;
			}
		}
		/* Supporting marketing content */

		.marketing {
			margin: 3rem 0;
		}

		.marketing p+h4 {
			margin-top: 1.5rem;
		}
		/* Responsive: Portrait tablets and up */

		@media screen and (min-width: 48em) {
			/* Remove the padding we set earlier */
			.header,
			.marketing,
			.footer {
				padding-right: 0;
				padding-left: 0;
			}
			/* Space out the masthead */
			.header {
				margin-bottom: 2rem;
			}
			/* Remove the bottom border on the jumbotron for visual effect */
			.jumbotron {
				border-bottom: 0;
			}
		}
	</style>

	<div class="container">
		<div class="header clearfix">
			<nav>
				<ul class="nav nav-pills float-right">
					<li class="nav-item">
						<a class="nav-link active" href="#">Home <span class="sr-only">(current)</span></a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="#">About</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="#">Contact</a>
					</li>
				</ul>
			</nav>
			<h3 class="text-muted">Metronome</h3>
		</div>

		<div class="jumbotron text-center">
			<!-- Time -->
			<span>
				<i class="fa fa-clock-o"></i>&nbsp;<label id="TimeLabel">0:00:00</label>
			</span>
			<br />
			<!-- Controls -->
			<button id="PlayPauseButton" type="button" class="btn btn-primary"><i class="fa fa-play"></i></button>
			<button id="StopButton" type="button" class="btn btn-primary"><i class="fa fa-stop"></i></button>
			<button id="VolumeDownButton" type="button" class="btn btn-primary"><i class="fa fa-volume-down"></i></button>
			<button id="VolumeUpButton" type="button" class="btn btn-primary"><i class="fa fa-volume-up"></i></button>
			<button id="VolumeOffButton" type="button" class="btn btn-primary"><i class="fa fa-volume-off"></i>&nbsp;<span id="VolumeSpan">100</span></button>
			<hr />
			<div class="row">
				<!-- BPM -->
				<div class="input-group col-md-6">
					<span class="input-group-addon"><i class="fa fa-spinner"></i>BPM</span>
					<input id="BPMInput" type="number" class="form-control" value="100" min="0" max="220">
					<div class="input-group-btn">
						<button id="BPMIncreaseButton" type="button" class="btn btn-primary btn-sm"><i class="fa fa-plus"></i></button>
						<button id="BPMDecreaseButton" type="button" class="btn btn-primary btn-sm"><i class="fa fa-minus"></i></button>
					</div>
					<button id="BPMTapButton" type="button" class="btn btn-secondary">Tap</button>
				</div>
				<!-- BPM Slider -->
				<div class="input-group col-md-6">
					<div class="m-auto">
						<input id="BPMSlider" type="hidden" />
					</div>
				</div>
			</div>
			<hr />
			<div class="row">
				<!-- Meter -->
				<div class="input-group col-md-6">
					<div class="input-group">
						<span class="input-group-addon"><i class="fa fa-tachometer"></i>Meter</span>
						<input id="BeatsInput" type="number" class="form-control" value="4" min="0" max="10">
						<span class="input-group-addon">/</span>
						<input id="SubunitsInput" type="number" class="form-control" value="4" min="0" max="4">
						<div class="input-group-btn">
							<button type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></button>
							<div class="dropdown-menu dropdown-menu-right">
								<a class="dropdown-item" href="javascript:setMeter(1,1)">1</a>
								<a class="dropdown-item" href="javascript:setMeter(2,1)">2</a>
								<a class="dropdown-item" href="javascript:setMeter(3,1)">3</a>
								<a class="dropdown-item" href="javascript:setMeter(4,1)">4</a>
								<a class="dropdown-item" href="javascript:setMeter(3,4)">3/4</a>
								<a class="dropdown-item" href="javascript:setMeter(4,4)">4/4</a>
							</div>
						</div>
					</div>
				</div>
				<!-- Subdivisions -->
				<div class="input-group col-md-6">
					<span class="input-group-addon"><i class="fa fa-music"></i>Subdivisions</span>
					<input id="SubdivisionsInput" type="text" class="form-control" data-toggle="dropdown" placeholder="None" disabled style="background-color:white;">
					<div class="input-group-btn">
						<button type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></button>
						<div class="dropdown-menu dropdown-menu-right">
							<a class="dropdown-item" href="javascript:setSubdivisions('None')">None</a>
							<a class="dropdown-item" href="javascript:setSubdivisions('Single')">Single</a>
							<a class="dropdown-item" href="javascript:setSubdivisions('Duple')">Duple</a>
							<a class="dropdown-item" href="javascript:setSubdivisions('Triple')">Triple</a>
							<a class="dropdown-item" href="javascript:setSubdivisions('Quadruple')">Quadruple</a>
							<a class="dropdown-item" href="javascript:setSubdivisions('Quintuple')">Quintuple</a>
							<a class="dropdown-item" href="javascript:setSubdivisions('Sextuple')">Sextuple</a>
							<a class="dropdown-item" href="javascript:setSubdivisions('Septuple')">Septuple</a>
							<div role="separator" class="dropdown-divider"></div>
							<a class="dropdown-item" href="javascript:setSubdivisions('Tripple 3rd')">Tripple 3rd</a>
							<a class="dropdown-item" href="javascript:setSubdivisions('Quadruple 4th')">Quadruple 4th</a>
						</div>
					</div>
				</div>
			</div>

		</div>

		<div class="row marketing">
			<div class="col-lg-6">
				<h4>Subheading</h4>
				<p>Donec id elit non mi porta gravida at eget metus. Maecenas faucibus mollis interdum.</p>

				<h4>Subheading</h4>
				<p>Morbi leo risus, porta ac consectetur ac, vestibulum at eros. Cras mattis consectetur purus sit amet fermentum.</p>

				<h4>Subheading</h4>
				<p>Maecenas sed diam eget risus varius blandit sit amet non magna.</p>
			</div>

			<div class="col-lg-6">
				<h4>Subheading</h4>
				<p>Donec id elit non mi porta gravida at eget metus. Maecenas faucibus mollis interdum.</p>

				<h4>Subheading</h4>
				<p>Morbi leo risus, porta ac consectetur ac, vestibulum at eros. Cras mattis consectetur purus sit amet fermentum.</p>

				<h4>Subheading</h4>
				<p>Maecenas sed diam eget risus varius blandit sit amet non magna.</p>
			</div>
		</div>

		<footer class="footer">
			<p>&copy; Company 2017</p>
		</footer>
	</div>

	<script type="application/javascript">
		class Timer {
			constructor() {
				this.startTime = null;
				this.timer = null;
				this.interval = 250; // adjust this number to affect granularity, lower numbers are more accurate, but more CPU-expensive
			}
			start(callback) {
				if (!this.startTime) {
					this.startTime = new Date().getTime();
				}
				this.timer = setInterval(() => {
					const now = new Date().getTime();
					const distance = now - this.startTime;
					const h = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
					const m = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
					const s = Math.floor((distance % (1000 * 60)) / 1000);
					const ms = Math.floor((distance % 1000));
					callback(h, m, s, ms);

				}, this.interval);
			}
			pause() {
				if (this.timer) {
					clearInterval(this.timer);
				}
			}
			stop() {
				if (this.timer) {
					clearInterval(this.timer);
				}
				this.startTime = null;
			}
		}
	</script>
	<script type="application/javascript">
		//https://github.com/goldfire/howler.js

		const sound = new Howl({
			src: ['./Sounds/Drum Hits/Snares/ClapAnalog.wav'],
			loop: true,
			rate: 1.0
		});
		let playing = false;

		// :: Time ::

		const timer = new Timer();
		const timeLabel = $('#TimeLabel');

		// :: Controls ::

		const playPauseButton = $('#PlayPauseButton');
		const stopButton = $('#StopButton');
		const volumeUpButton = $('#VolumeUpButton');
		const volumeDownButton = $('#VolumeDownButton');
		const volumeOffButton = $('#VolumeOffButton');
		const volumeSpan = $('#VolumeSpan');

		playPauseButton.click(() => {

			if (playing) {
				playPauseButton.html('<i class="fa fa-play"></i>');
				sound.pause();
				timer.pause();
			} else {
				playPauseButton.html('<i class="fa fa-pause"></i>');
				sound.play();
				timer.start((h, m, s, ms) => timeLabel.text(h + ':' + ("0" + m).slice(-2) + ':' + ("0" + s).slice(-2)));
			}
			playing = !playing;
		});
		stopButton.click(() => {

			playPauseButton.html('<i class="fa fa-play"></i>');
			sound.stop();
			timer.stop();
			timeLabel.text('0:00:00');
			playing = false;
		});
		volumeUpButton.click(() => {

			const clampedVolume = Math.min(sound.volume() + 0.1, 1.0).toPrecision(1);
			volumeSpan.text(clampedVolume * 100);
			sound.volume(clampedVolume);
		});
		volumeDownButton.click(() => {

			const clampedVolume = Math.max(sound.volume() - 0.1, 0.0).toPrecision(1);
			volumeSpan.text(clampedVolume * 100);
			sound.volume(clampedVolume);
		});
		volumeOffButton.click(() => {

			const isMuted = sound.mute();
			isMuted ? volumeSpan.show() : volumeSpan.hide(); // Invert cuz we gonna change it now
			sound.mute(!isMuted);
		});

		// ==== BPM ====

		// :: BPM Input ::

		const bpmInput = $('#BPMInput');
		const bpmIncreaseButton = $('#BPMIncreaseButton');
		const bpmDecreaseButton = $('#BPMDecreaseButton');
		const bpmTapButton = $('#BPMTapButton');
		let taps = [];
		const tapTimeout = 1000 * 4;

		bpmInput.change(() => setBPM(parseInt(bpmInput.val())));
		bpmIncreaseButton.click(() => setBPM(parseInt(bpmInput.val()) + 10));
		bpmDecreaseButton.click(() => setBPM(parseInt(bpmInput.val()) - 10));

		bpmTapButton.click(() => {

			const now = new Date().getTime();
			if (taps.length > 0 && (now - taps[taps.length - 1]) > tapTimeout) {
				taps = [];
				setBPM(parseInt(100));
			}
			taps.push(now);
			if (taps.length === 1) {
				return;
			}
			const tapsDifference = [];
			for (let index = 1; index < taps.length; index++) {
				tapsDifference.push(taps[index] - taps[index - 1]);
			}
			const avg = (tapsDifference.reduce((a, b) => a + b) / tapsDifference.length);
			const bpm = (1000 * 60) / avg;
			setBPM(parseInt(bpm));
		});

		// :: BPM Slider ::

		//https://github.com/seiyria/bootstrap-slider

		const bpmSlider = $('#BPMSlider').bootstrapSlider({
			min: bpmInput.attr('min'),
			max: bpmInput.attr('max'),
			value: bpmInput.val(),
			step: 1,
		});
		bpmSlider.change(() => setBPM(bpmSlider.bootstrapSlider('getValue')));

		function setBPM(value) {

			const clampedValue = Math.max(Math.min(value, bpmInput.attr('max')), bpmInput.attr('min'));
			bpmSlider.bootstrapSlider('setValue', clampedValue);
			bpmInput.val(clampedValue);
		}

		// :: Meter ::

		const beatsInput = $('#BeatsInput');
		const subunitsInput = $('#SubunitsInput');

		function setMeter(beats, subunits) {

			beatsInput.val(beats);
			subunitsInput.val(subunits);
		}

		// :: Subdivisions ::

		const subdivisionsInput = $('#SubdivisionsInput');

		function setSubdivisions(subdivisions) {

			subdivisionsInput.val(subdivisions);
		}
	</script>

	<script>
		/*!
		 * IE10 viewport hack for Surface/desktop Windows 8 bug
		 * Copyright 2014-2017 The Bootstrap Authors
		 * Copyright 2014-2017 Twitter, Inc.
		 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
		 */

		// See the Getting Started docs for more information:
		// https://getbootstrap.com/getting-started/#support-ie10-width

		(function () {
			'use strict'

			if (navigator.userAgent.match(/IEMobile\/10\.0/)) {
				var msViewportStyle = document.createElement('style')
				msViewportStyle.appendChild(
					document.createTextNode(
						'@-ms-viewport{width:auto!important}'))
				document.head.appendChild(msViewportStyle)
			}

		}())
	</script>
</body>

</html>